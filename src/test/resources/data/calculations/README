CALCULATIONS:

PAYE:

Variables calculated: 

1. paye_employees: a sum of paye employees averages of all Legal Units of the Enterprise
2. paye_jobs: a sum of last quarters across all Legal Units of the Enterprice

paye_job calcuation:
1. Calcuate a average for each paye_ref: sum of all quartes devided by a number of quarted with non-null values
2. Sum averages calculated at step 1 above

VAT:

Record types:
0 - Standard
1 - Representative
2 - Divisional
3 - Non-Representative


 Variables calculated:

 1. contained_group_turnover: 
     1.1 Identify vat group members by selecting records with same first 9 digits
     1.2 Each vat group has 1 representative turnover and 1 + non-representative turnovers
     1.3 Ensure relevance of contained_group_turnover by confirming all given vat group lays within one enterprise. If this is the case, continue
     1.4 Return the value of representative turnover

 2. apportioned_turnover:
     1.1 Ensure given group includes multiple enterprises
     1.2 Extract representative turnover of the given group
     1.3 Calculate weights of turnovers across multiple Enterprises belonging to this vat group:
         1.2.1 Calculate total group payee_employee by summing paye_employees of all Enterprises of the group
         1.2.2 Calculate apportioned turnover for each ENT-n of the group: (group_rep_turnover / total group payee_employee) * ENT-n.paye_employees

 3. ent_turnover:
    contained_turnover + apportioned_turnover + standard_turnover

So, having inputs:
PAYE:

+--------------------+--------------+--------------------+----------+------------+-------+--------+---------+---------+--------+----------+
|        BusinessName|      PayeRefs|             VatRefs|       ern|          id|payeref|mar_jobs|june_jobs|sept_jobs|dec_jobs|quoter_avg|
+--------------------+--------------+--------------------+----------+------------+-------+--------+---------+---------+--------+----------+
|      INDUSTRIES LTD|       [1151L]|      [123123123000]|2000000011|100002826247|  1151L|       1|        2|        3|       4|         2|
|BLACKWELLGROUP LT...|[1152L, 1153L]|      [111222333000]|1100000003|100000246017|  1152L|       5|        6|     null|       8|         6|
|BLACKWELLGROUP LT...|[1152L, 1153L]|      [111222333000]|1100000003|100000246017|  1153L|       9|        1|        2|       3|         3|
|BLACKWELLGROUP LT...|[1154L, 1155L]|      [111222333001]|1100000003|100000827984|  1154L|       4|     null|        6|       7|         5|
|BLACKWELLGROUP LT...|[1154L, 1155L]|      [111222333001]|1100000003|100000827984|  1155L|       8|        9|        1|       2|         5|
|             IBM LTD|[1166L, 1177L]|[555666777000, 55...|1100000004|100000459235|  1166L|       1|        1|        2|       3|         1|
|             IBM LTD|[1166L, 1177L]|[555666777000, 55...|1100000004|100000459235|  1177L|    null|     null|     null|    null|      null|
|         IBM LTD - 2|[1188L, 1199L]|      [555666777002]|1100000004|100000508723|  1188L|       2|        2|        2|       2|         2|
|         IBM LTD - 2|[1188L, 1199L]|      [555666777002]|1100000004|100000508723|  1199L|    null|     null|     null|    null|      null|
|         IBM LTD - 3|[5555L, 3333L]|      [999888777000]|1100000004|100000508724|  5555L|    null|     null|     null|    null|      null|
|         IBM LTD - 3|[5555L, 3333L]|      [999888777000]|1100000004|100000508724|  3333L|       1|        1|        2|       3|         1|
|             MBI LTD|       [9876L]|      [555666777003]|2200000002|100000601835|  9876L|       6|        5|        4|       3|         4|
|   NEW ENTERPRISE LU|          null|      [919100010000]|9900000009|999000508999|   null|    null|     null|     null|    null|      null|
+--------------------+--------------+--------------------+----------+------------+-------+--------+---------+---------+--------+----------+
VATS:
+--------------+----------+-------------+
|    vatref    | turnover | record_type |
+--------------+----------+-------------+
| 555666777003 |   260    |     3       |
| 919100010000 |    85    |     2       |
| 999888777000 |   260    |     0       |
| 555666777002 |   340    |     3       |
| 555666777000 |  1000    |     1       |
| 555666777001 |   320    |     3       |
| 111222333001 |   590    |     3       |
| 111222333000 |   585    |     1       |
| 123123123000 |   390    |     0       |
+--------------+----------+-------------+

